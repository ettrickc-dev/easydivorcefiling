<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NY Uncontested Divorce ‚Äî Fast Legal Templates (Self-Contained)</title>
<link rel="canonical" href="https://fastlegaltemplates.com/ny-divorce"/>
<meta name="description" content="Generate court-ready New York uncontested divorce documents online. Secure online checkout. Clear instructions and step-by-step guidance."/>
<meta name="robots" content="index,follow"/>

<style>
:root{--primary:#007bff;--primary-dark:#0056b3;--success:#28a745;--warning:#ffc107;--danger:#dc3545;--ink:#212529;--line:#e9ecef;--bg-light:#f8f9fa;}
html,body{background:#fff;}
body{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;margin:0;color:var(--ink);font-size:18px;line-height:1.6;}
.wrap{max-width:980px;margin:10px auto;padding:0 15px;}
h1{font-size:2.2rem;margin:.25rem 0 .5rem;font-weight:700;}
h3{font-size:1.6rem;margin:.1rem 0 .4rem;font-weight:600;color:var(--primary-dark);}
.card{border:1px solid var(--line);border-radius:12px;background:#fff;padding:20px;margin:18px 0;box-shadow:0 4px 10px rgba(0,0,0,.05);}
label{display:block;font-weight:700;margin:0 0 5px;font-size:18px;color:var(--ink);}
input,select,textarea{width:100%;padding:14px 12px;border:1px solid var(--line);border-radius:8px;font-size:18px;background:var(--bg-light);transition:box-shadow .15s,border-color .15s;box-sizing:border-box;}
input:focus,select:focus,textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(0,123,255,.25);background:#fff;}
textarea{min-height:90px;resize:vertical;}
.grid{display:grid;gap:15px;}
@media(min-width:860px){.cols-2{grid-template-columns:1fr 1fr} .form-content-cols{display:grid;grid-template-columns:1fr 1fr;gap:40px;} .column-left{border-right:1px solid var(--line);padding-right:38px;}}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:.6rem;padding:14px 24px;border-radius:8px;border:none;font-weight:700;text-decoration:none;cursor:pointer;font-size:1.1rem;box-shadow:0 4px 10px rgba(0,0,0,.1);transition:background .2s,transform .1s,box-shadow .2s;}
.next{background:var(--primary);color:#fff;}
.next:hover{background:var(--primary-dark);transform:translateY(-1px);box-shadow:0 6px 15px rgba(0,123,255,.3);}
.good{background:var(--success);color:#fff;}
.good:hover{background:#1e7e34;transform:translateY(-1px);box-shadow:0 6px 15px rgba(40,167,69,.3);}
.warning-btn{background:var(--warning);color:#000;font-size:1.2rem;padding:18px 22px;}
.warning-btn:hover{background:#e0a800;transform:translateY(-1px);box-shadow:0 6px 15px rgba(255,193,7,.3);}
.cta-blinking{animation:blinker 1s cubic-bezier(.5,0,1,1) infinite alternate;box-shadow:0 0 15px 5px var(--warning);}
@keyframes blinker{from{opacity:1;box-shadow:0 0 15px 5px rgba(255,193,7,.8);}to{opacity:.7;box-shadow:0 0 5px 2px rgba(255,193,7,.2);}}
.block{width:100%;}
.small{font-size:1rem;color:#6c757d;}
.err{color:var(--danger);font-weight:700;margin-top:5px;display:none;font-size:1.1rem;}
.step{display:none}.step.active{display:block}
.hide{display:none !important}
#gd,#headsup,#payCard{display:none;}
.okline{height:5px;border-radius:999px;background:linear-gradient(90deg,var(--primary-dark),var(--primary),var(--line));margin:8px 0;opacity:.9;}
.download-section h3{color:var(--success);}
.download-buttons button{margin-top:10px !important;}
.pay-card{background:#fff;border:3px solid var(--primary);}
.pay-card h4{font-size:1.4rem;}
.pay-card .pay-banner strong{color:var(--danger)!important;}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111;color:#fff;padding:10px 14px;border-radius:8px;display:none;z-index:9999}
.trust-row{display:grid;gap:10px}
@media(min-width:720px){.trust-row{grid-template-columns:1fr 1fr 1fr 1fr}}
.trust-chip{display:flex;align-items:center;gap:8px;padding:10px 12px;border:1px solid var(--line);border-radius:999px;background:#fff}
.trust-chip svg{flex:0 0 auto}
.notice-box{display:flex;gap:12px;align-items:flex-start;background:#f1f8ff;border:1px solid #d6e9ff;border-radius:10px;padding:14px;margin-top:10px}
.notice-box strong{color:#0b5ed7}
</style>
</head>

<body>
<section id="DivorceFormContainer">
  <div class="wrap">
    <div class="card">
      <h1>NY Uncontested Divorce: Complete Your Case Fast</h1>
      <div class="small">The quickest, most affordable way to get your final divorce judgment without a lawyer. Answer the simple questions below.</div>
      <div class="okline" id="streak"></div>

      <div class="trust-row" aria-label="Trust & Safety Signals" style="margin-top:12px">
        <div class="trust-chip" title="Secure Online Checkout">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 1l3 5 5 .5-3.5 4 1 5-5-2.5L7 16l1-5L4.5 6.5 10 6l2-5z"/></svg>
          <span>Secure Online Checkout</span>
        </div>
        <div class="trust-chip" title="Court-ready formatting">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M4 4h16v16H4zM8 8h8M8 12h8M8 16h5"/></svg>
          <span>Court-Ready Documents</span>
        </div>
        <div class="trust-chip" title="Step-by-step guidance">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2v20M5 7h14M5 12h9M5 17h6"/></svg>
          <span>Step-by-Step Guidance</span>
        </div>
        <div class="trust-chip" title="Email support">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M4 4h16v16H4z"/><path d="M22 6l-10 7L2 6"/></svg>
          <span>Email Support Included</span>
        </div>
      </div>

      <div class="notice-box" role="note">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"/><path d="M12 8v4M12 16h.01"/></svg>
        <div><strong>You‚Äôre not alone:</strong> This tool is designed for self-represented New Yorkers. Clear prompts, plain-English instructions, and a simple checklist keep you on track from start to finish.</div>
      </div>
    </div>

    <div class="card value-prop">
      <div class="trust-badge">‚úÖ Court-Ready Documents Guaranteed. Zero Lawyer Fees.</div>
      <h3>1. Quick Requirements Check</h3>
      <div class="small">
        By proceeding, you confirm: <strong>no children</strong> of the marriage; either you or your spouse <strong>lives in NY</strong>; <strong>no marital assets</strong> dispute; and your spouse <strong>will consent</strong> by signing the forms.
      </div>
      <div class="grid cols-2" style="margin-top:10px">
        <div>
          <div class="row" style="align-items:flex-start;">
            <input type="checkbox" id="ack" style="width:24px;height:24px;margin-top:2px;">
            <label for="ack" class="small" style="margin:0 0 0 10px; font-weight:500; font-size:18px;">I confirm I meet all four requirements.</label>
          </div>
        </div>
        <div>
          <label>Your Contact Email (for receipt)</label>
          <input id="email" placeholder="email@example.com">
        </div>
      </div>
      <div style="margin-top:15px;">
        <label>Primary Phone Number (Required for court forms) *</label>
        <input id="phone" placeholder="(___) ___-____">
      </div>
    </div>

    <!-- STEP 2 -->
    <div class="card step active" data-step="1">
      <h3>2. Plaintiff & Marriage Information</h3>
      <div class="form-content-cols">
        <div class="column-left">
          <div class="grid cols-2">
            <div>
              <label>Your Role *</label>
              <select id="you_are">
                <option value="">Select‚Ä¶</option>
                <option value="HUSBAND">Husband (Plaintiff)</option>
                <option value="WIFE">Wife (Plaintiff)</option>
              </select>
            </div>
            <div>
              <label>Your Full Name *</label>
              <input id="pl_name" placeholder="First Last">
            </div>
          </div>
          <label>Your Current Full Address *</label>
          <textarea id="pl_addr" placeholder="Street, City, State ZIP"></textarea>
          <div class="grid cols-2">
            <div><label>Your Date of Birth *</label><input id="pl_dob" type="date"></div>
            <div><label>Filing County (Where to file) *</label><select id="county"></select></div>
          </div>
          <div style="margin-top:15px;">
            <label id="venue_label">Filing Residency Reason in Select‚Ä¶ *</label>
            <select id="venue_reason" disabled>
              <option value="">Select‚Ä¶</option>
              <option value="PLAINTIFF_LIVES">Because I live there</option>
              <option value="DEFENDANT_LIVES">Because my spouse lives there</option>
            </select>
          </div>
        </div>
        <div class="column-right">
          <label>Marriage Location *</label>
          <select id="m_where">
            <option value="">Select‚Ä¶</option>
            <option value="US">United States</option>
            <option value="INTL">Outside the U.S.</option>
          </select>
          <div class="grid cols-2" style="margin-top:15px">
            <div>
              <label>Marriage Date *</label>
              <input id="m_date" type="date">
            </div>
            <div id="us_pair" class="hide">
              <div class="grid cols-2">
                <div><label>Marriage City *</label><input id="m_city"></div>
                <div><label>Marriage State *</label><select id="m_state"></select></div>
              </div>
            </div>
            <div id="intl_pair" class="hide">
              <div class="grid cols-2">
                <div><label>Marriage Town *</label><input id="m_town"></div>
                <div><label>Marriage Country *</label><input id="m_country"></div>
              </div>
            </div>
          </div>
          <div class="card" style="margin-top:20px; margin-left:-20px; margin-right:-20px; padding:15px 20px; border:none; background:var(--bg-light);">
            <label>Prior/Maiden Surname(s)</label>
            <div class="row" style="gap:20px">
              <label class="small"><input type="radio" name="prior_who" value="NONE" checked> Neither</label>
              <label class="small"><input type="radio" name="prior_who" value="YOU"> I do</label>
              <label class="small"><input type="radio" name="prior_who" value="SPOUSE"> Spouse does</label>
              <label class="small"><input type="radio" name="prior_who" value="BOTH"> Both</label>
            </div>
            <div id="you_prior_wrap" class="hide" style="margin-top:10px">
              <label>Your Prior/Maiden Surname</label><input id="pl_prior" placeholder="Enter your prior surname">
              <div class="row" style="margin-top:5px"><input type="checkbox" id="resume_pl" style="width:20px;height:20px"><label for="resume_pl" class="small" style="margin:0 0 0 8px; font-weight:400; font-size:16px;">Request to legally resume this surname</label></div>
            </div>
            <div id="spouse_prior_wrap" class="hide" style="margin-top:10px">
              <label>Spouse Prior/Maiden Surname</label><input id="sp_prior" placeholder="Enter spouse's prior surname">
              <div class="row" style="margin-top:5px"><input type="checkbox" id="resume_sp" style="width:20px;height:20px"><label for="resume_sp" class="small" style="margin:0 0 0 8px; font-weight:400; font-size:16px;">Request to legally resume spouse‚Äôs prior surname</label></div>
            </div>
          </div>
        </div>
      </div>
      <div class="err" id="e1">üõë Please complete all *required* fields and confirm the requirements before continuing.</div>
      <div class="row" style="margin-top:20px">
        <button class="btn next block" id="toStep2">Continue to Step 3 (Spouse Info) ‚Üí</button>
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="card step" data-step="2">
      <h3>3. Spouse Information & Final Check</h3>
      <div class="form-content-cols">
        <div class="column-left">
          <div class="grid cols-2">
            <div>
              <label><span id="spLabelA">Spouse's</span> Full Name *</label>
              <input id="def_name" placeholder="First Last">
            </div>
            <div><label><span id="spLabelB">Spouse's</span> Date of Birth *</label><input id="def_dob" type="date"></div>
          </div>
          <label><span id="spLabelC">Spouse's</span> Current Full Address *</label>
          <textarea id="def_addr" placeholder="Street, City, State ZIP"></textarea>
        </div>
        <div class="column-right">
          <div class="grid cols-2">
            <div>
              <label>Your SSN (last 4 ‚Äî enter ‚Äúnone‚Äù if you do not have a SSN)</label>
              <input id="pl_ssn" placeholder="1234 or none" maxlength="4">
            </div>
            <div>
              <label id="spSSNlbl">Spouse SSN (last 4 ‚Äî enter ‚Äúnone‚Äù if no SSN)</label>
              <input id="def_ssn" placeholder="1234 or none" maxlength="4">
            </div>
          </div>
          <div style="margin-top:20px;">
            <div class="testi" style="font-size:16px; background:var(--line); border:none; padding:12px; border-radius:8px;">
              "Fast, accurate, no stress. Documents were accepted the first time. Highly recommend." ‚Äî <em>Verified NY Customer</em>
            </div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:25px">
        <button class="btn good block" id="gen">4. Generate Initial Documents</button>
      </div>
      <div class="err" id="e2">üõë Please complete all *required* fields in Step 3.</div>

      <div id="downloads" class="hide" style="margin-top:25px">
        <div class="okline" style="background:linear-gradient(90deg,var(--primary-dark),var(--success));height:8px;"></div>
        <div class="download-section" style="margin-top:20px;">

          <h3 class="bigtitle" style="color:var(--ink); font-weight:700;">‚úÖ Step 5: Start Your Case (Initial Document)</h3>
          <div class="small" style="font-size:1.1rem; margin-bottom:18px;">
            The <strong>Summons and Complaint</strong> is completed and ready. Download it now to <strong>officially START</strong> your divorce case by filing with your County Clerk.
          </div>

          <!-- ALWAYS-FREE S&C button (ungated) -->
          <button class="btn warning-btn block" data-doc="COMPLAINT" id="btnSAndC">
            Download ‚Äî Summons & Complaint (File to START Case)
          </button>

          <!-- Paywall CTA -->
          <div style="margin-top:25px; padding:20px; border:1px dashed var(--warning); border-radius:8px; background:#fffbf4;" id="headsup">
            <button id="ctaUnlock" class="btn warning-btn block cta-blinking" style="font-size:1.6rem; padding:25px 10px;">
              üö® Click Here to <strong>UNLOCK</strong> Your Full Final Judgment Package & Instructions ($99) üö®
            </button>
            <div class="small" style="text-align:center;margin-top:8px;">
              <em>Secure online checkout. You can use any major card.</em>
            </div>
          </div>

          <!-- Pay card (Stripe Buy Button integrated) -->
          <div class="card pay-card" id="payCard" style="grid-column:1 / -1; margin-top:25px;">
            <h4>Final Judgment Package ‚Äî Secure Payment ($99)</h4>
            <div class="pay-banner" style="font-size:1.1rem;">
              <strong>Includes:</strong> All completed forms, county-specific checklist, and clear filing instructions.
            </div>
            <div class="row" style="margin-top:12px; flex-wrap:nowrap; gap:15px;">
              <div class="small" style="font-weight:700; font-size:1.1rem;">‚úî Court-Ready Formatting</div>
              <div class="small" style="font-weight:700; font-size:1.1rem;">‚úî Step-by-Step Guidance</div>
              <div class="small" style="font-weight:700; font-size:1.1rem;">‚úî Secure Online Payment</div>
            </div>

            <!-- STRIPE BUY BUTTON (can be swapped for PayPal later) -->
            <div id="stripeWrap" style="margin-top:18px;">
              <script async src="https://js.stripe.com/v3/buy-button.js"></script>
              <stripe-buy-button
                buy-button-id="buy_btn_1SJaA3HcizSl783niCLfFOEp"
                publishable-key="pk_live_51SJOPLHcizSl783nCwX95ZH1ooDquZ6C7Y02DwLmLKATKqb60yIm6jAlZVatlfvgZ5aCM1F1EmnjYktmTHufXM8E00eTlFQIan">
              </stripe-buy-button>
            </div>

            <div class="small" style="text-align:center;margin-top:10px;">
              By paying, you agree to our <a href="https://fastlegaltemplates.com/terms" target="_blank" rel="noopener">Terms</a> and <a href="https://fastlegaltemplates.com/privacy" target="_blank" rel="noopener">Privacy Policy</a>.
            </div>
          </div>

          <!-- Unlocked downloads -->
          <div id="gd" class="download-buttons">
            <h3 style="margin-top:25px;">üéâ Full Package Unlocked!</h3>
            <div class="small" style="margin-bottom:15px; font-size:1.1rem; color:var(--success); font-weight:700;">
              All documents and your step-by-step instructions are ready. Download them below to <strong>finish</strong> your divorce.
            </div>
            <div class="grid cols-2">
              <button class="btn next block" data-doc="COMPLAINT">1. Summons & Complaint (For Filing)</button>
              <button class="btn next block" data-doc="AFF_P">2. Affirmation of Plaintiff</button>
              <button class="btn next block" data-doc="AFF_D">3. Affirmation of Defendant (Consent)</button>
              <button class="btn next block" data-doc="REG">4. Affirmation of Regularity</button>
              <button class="btn next block" data-doc="FIND">5. Findings & Conclusions</button>
              <button class="btn next block" data-doc="JUDG">6. [Proposed] Judgment of Divorce</button>
              <button class="btn next block" data-doc="NOI">7. Note of Issue</button>
              <button class="btn next block" data-doc="CERT">8. Certification</button>
              <button class="btn next block" data-doc="RJI">9. RJI (PDF)</button>
              <button class="btn next block" data-doc="CERTDISS">10. Certificate of Dissolution (PDF)</button>
              <button class="btn next block" data-doc="INSTR">11. Step-by-Step Instructions</button>
            </div>

            <div class="row" style="margin-top:15px;">
              <button id="downloadAll" class="btn good block">‚¨á Download All Now</button>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="card small" style="margin-top:25px; font-size:14px; padding:12px; background:var(--bg-light);">
      Disclaimer: This is a document preparation service. We prepare the documents from your answers; you are responsible for signing and filing them per the included instructions.
    </div>
  </div>

  <div class="toast" id="toast"></div>
</section>

<!-- Libs -->
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
/* ======= Paste the base64 for each template below (no data: prefix) ======= */
const EMBEDDED_TEMPLATES = {
  COMPLAINT:  "__B64_COMPLAINT__",          // COMPLAINT.docx
  AFF_P:      "__B64_AFFIRMATION_P__",      // AFFIRMATION OF PLAINTIFF.docx
  AFF_D:      "__B64_AFFIRMATION_D__",      // AFFIRMATION OF DEFENDANT.docx
  REG:        "__B64_REGULARITY__",         // AFFIRMATION OF REGULARITY.docx
  FIND:       "__B64_FINDINGS__",           // FINDINGS.docx
  JUDG:       "__B64_JUDGMENT__",           // JUDGMENT.docx
  NOI:        "__B64_NOTE_OF_ISSUE__",      // NOTE OF ISSUE.docx
  CERT:       "__B64_CERTIFICATION__",      // CERTIFICATION.docx
  INSTR:      "__B64_INSTRUCTIONS__",       // INSTRUCTIONS.docx
  RJI:        "__B64_RJI_PDF__",            // RJI.pdf (PDF)
  CERTDISS:   "__B64_CERT_OF_DISS_PDF__"    // Certificate of Dissolution.pdf (PDF)
};
/* ======================================================================== */

const FINAL_KEY="ud_isFinal_v1"; const $=id=>document.getElementById(id);
function toast(msg, ok=false){ const t=$('toast'); t.textContent=msg; t.style.background=ok?'#065f46':'#111'; t.style.display='block'; setTimeout(()=>t.style.display='none',3000); }
function setChoices(id, arr, ph="Select‚Ä¶"){ const s=$(id); s.innerHTML=""; const o=document.createElement('option');o.value="";o.textContent=ph;s.appendChild(o); arr.forEach(v=>{const x=document.createElement('option');x.value=v;x.textContent=v;s.appendChild(x);}); }
function xmlEscape(v){ return String(v||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&apos;'); }
function formatDateLong(i){ if(!i) return ''; const [y,m,d]=i.split('-').map(x=>parseInt(x,10)); if(!y||!m||!d) return i; const dt=new Date(y,m-1,d); const month=dt.toLocaleString('en-US',{month:'long'}); return `${month} ${d}, ${y}`; }
function normalizeXmlRuns(x){ return x.replace(/<\/w:t>\s*<\/w:r>\s*<w:r[^>]*>\s*<w:t[^>]*>/g,''); }

function buildReplacementMap(a){
  const m=new Map();
  const county=xmlEscape(a.county),
        pl_name=xmlEscape(a.pl_name),
        def_name=xmlEscape(a.def_name),
        pl_addr=xmlEscape(a.pl_addr),
        def_addr=xmlEscape(a.def_addr),
        phone=xmlEscape(a.phone);
  const gmLong=formatDateLong(a.m_date),
        dBirthLong=formatDateLong(a.pl_dob),
        kBirthLong=formatDateLong(a.def_dob);
  const venued=(a.venue_reason==='PLAINTIFF_LIVES')?'PLAINTIFF':'DEFENDANT';

  m.set(/\[KINGS\]/gi, county);
  m.set(/\[JANE\s+DOE\]/gi, pl_name);
  m.set(/\[JOHN\s+DOE\]/gi, def_name);

  // ‚úÖ Insert Defendant name into "Defendant:  Office and P.O. Address:"
  m.set(/Defendant:\s+Office and P\.O\. Address:/g, `Defendant: ${def_name} Office and P.O. Address:`);

  if(a.venue_reason==='PLAINTIFF_LIVES'){
    m.set(/The basis of venue is \[Plaintiff's\] residence\./g,"The basis of venue is Plaintiff's residence.");
    m.set(/Plaintiff resides at \[1 MAIN STREET, BROOKLYN, NEW YORK 11208\]\./g, `Plaintiff resides at ${pl_addr}.`);
    m.set(/The \[Plaintiff\] has resided in New York State for a continuous period in excess of two years immediately preceding the commencement of this action\./g, "The Plaintiff has resided in New York State for a continuous period in excess of two years immediately preceding the commencement of this action.");
    // SECOND paragraph: [Plaintiff] ‚Üí Plaintiff (no brackets) when venue is Plaintiff
    m.set(/\[Plaintiff\]/g,"Plaintiff");
  }else{
    m.set(/The basis of venue is \[Plaintiff's\] residence\./g,"The basis of venue is Defendant‚Äôs residence.");
    m.set(/Plaintiff resides at \[1 MAIN STREET, BROOKLYN, NEW YORK 11208\]\./g, `Defendant resides at ${def_addr}.`);
    m.set(/The \[Plaintiff\] has resided in New York State for a continuous period in excess of two years immediately preceding the commencement of this action\./g, "The Defendant has resided in New York State for a continuous period in excess of two years immediately preceding the commencement of this action.");
    // SECOND paragraph: [Plaintiff] ‚Üí Defendant (no brackets) when venue is Defendant
    m.set(/\[Plaintiff\]/g,"Defendant");
  }

  m.set(/\[1 MAIN STREET BROOKLYN, NEW YORK 11208\]/g, pl_addr);
  m.set(/\[2 CENTRAL AVENUE, QUEENS, NEW YORK 11422\]/g, def_addr);

  if(gmLong){
    m.set(/\[April 22, 2020\]/g, gmLong);
    m.set(/GMARRIAGEDATE/g, gmLong);
    m.set(/G[\u00A0\u200B\u200C\u200D\uFEFF\s]*MARRIAGEDATE/gi, gmLong);
  } else {
    m.set(/GMARRIAGEDATE/g, '');
    m.set(/G[\u00A0\u200B\u200C\u200D\uFEFF\s]*MARRIAGEDATE/gi, '');
  }

  if(a.m_where==='US'){
    if(a.m_city) m.set(/COUNTY OF \[QUEENS\] AND STATE OF \[NEW YORK\]\./g, `COUNTY OF ${xmlEscape(a.m_city).toUpperCase()} AND STATE OF NEW YORK.`);
  }else{
    m.set(/COUNTY OF \[QUEENS\] AND STATE OF \[NEW YORK\]\./g, `TOWN OF ${xmlEscape(a.m_town).toUpperCase()} AND COUNTRY OF ${xmlEscape(a.m_country).toUpperCase()}.`);
  }

  if(phone) m.set(/\[PHONE\]/g, phone);

  // ‚úÖ SSN handling: last 4 only, "none" treated as blank, mapped to correct spouse
  const plSSNraw=(a.pl_ssn||'').trim();
  const defSSNraw=(a.def_ssn||'').trim();
  const plSSN = plSSNraw.toLowerCase()==='none' ? '' : plSSNraw;
  const defSSN = defSSNraw.toLowerCase()==='none' ? '' : defSSNraw;

  // In the templates, use "XXX-XX-MSOCIAL" for Plaintiff and "XXX-XX-NSOCIAL" for Defendant
  m.set(/MSOCIAL/g, xmlEscape(plSSN));
  m.set(/NSOCIAL/g, xmlEscape(defSSN));

  m.set(/CADDRESS/g, pl_addr);
  m.set(/LADDRESS/g, def_addr);

  const townCity=a.m_where==='US'?(a.m_city||''):(a.m_town||'');
  m.set(/HTOWNCITY/g, xmlEscape(townCity));

  const stateCountry=a.m_where==='US'?(a.m_state||''):(a.m_country||'');
  m.set(/ISTATECOUNTRY/g, xmlEscape(stateCountry));

  if(dBirthLong) m.set(/DBIRTH/g, xmlEscape(dBirthLong));
  if(kBirthLong) m.set(/KBIRTH/g, xmlEscape(kBirthLong));
  m.set(/\[?VENUED\]?/g, venued);

  const plMaiden=((a.priorWho==='YOU'||a.priorWho==='BOTH')&&a.pl_prior)?a.pl_prior:'NOT APPLICABLE';
  const spMaiden=((a.priorWho==='SPOUSE'||a.priorWho==='BOTH')&&a.sp_prior)?a.sp_prior:'NOT APPLICABLE';
  m.set(/PLAINTIFFMAIDEN/g, xmlEscape(plMaiden));
  m.set(/DEFENDANTMAIDEN/g, xmlEscape(spMaiden));

  return m;
}

const NY_COUNTIES=["Albany","Allegany","Bronx","Broome","Cattaraugus","Cayuga","Chautauqua","Chemung","Chenango","Clinton","Columbia","Cortland","Delaware","Dutchess","Erie","Essex","Franklin","Fulton","Genesee","Greene","Hamilton","Herkimer","Jefferson","Kings","Lewis","Livingston","Madison","Monroe","Montgomery","Nassau","New York","Niagara","Oneida","Onondaga","Ontario","Orange","Orleans","Oswego","Otsego","Putnam","Queens","Rensselaer","Richmond","Rockland","St. Lawrence","Saratoga","Schenectady","Schoharie","Schuyler","Seneca","Steuben","Suffolk","Sullivan","Tioga","Tompkins","Ulster","Warren","Washington","Wayne","Westchester","Wyoming","Yates"];
const US_STATES=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];

function vStep1(){
  const need=i=>i.every(id=>(($(id).value)||'').toString().trim().length>0);
  const ok=need(['you_are','pl_name','pl_addr','pl_dob','county','venue_reason','m_where','m_date']);
  if(!ok)return false;
  if($('m_where').value==='US'){ if(!need(['m_city','m_state']))return false; }
  else { if(!need(['m_town','m_country']))return false; }
  const who=(document.querySelector('[name="prior_who"]:checked')||{}).value||'NONE';
  if((who==='YOU'||who==='BOTH')&&!$('pl_prior').value.trim())return false;
  if((who==='SPOUSE'||who==='BOTH')&&!$('sp_prior').value.trim())return false;
  return true;
}
function vStep2(){
  const need=i=>i.every(id=>(($(id).value)||'').toString().trim().length>0);
  return need(['def_name','def_addr','def_dob']);
}
function onRoleChange(){const role=$('you_are').value;const spouseIs=role==='HUSBAND'?'Wife':'Husband';$('spLabelA').textContent=spouseIs+"'s";$('spLabelB').textContent=spouseIs+"'s";$('spLabelC').textContent=spouseIs+"'s";$('spSSNlbl').textContent=spouseIs+" SSN (Last 4 digits - Optional)";}
function onCountyChange(){
  const sel=$('county');
  const txt=sel.options[sel.selectedIndex]?.text||'';
  $('venue_label').textContent = txt
    ? `Filing Residency Reason in ${txt} *`
    : 'Filing Residency Reason in Select‚Ä¶ *';
  const v=$('venue_reason');
  v.disabled=!txt;
  if(v.options[1])v.options[1].text=txt?`Because I live in ${txt}`:'Because I live there';
  if(v.options[2])v.options[2].text=txt?`Because my spouse lives in ${txt}`:'Because my spouse lives there';
}
function onWhereChange(){
  const where = $('m_where').value;
  const us = where === 'US';
  const intl = where === 'INTL';
  $('us_pair').classList.toggle('hide', !us);
  $('intl_pair').classList.toggle('hide', !intl);
  $('m_city').required = us;
  $('m_state').required = us;
  $('m_town').required = intl;
  $('m_country').required = intl;
}
function onPriorRadio(){const v=(document.querySelector('[name="prior_who"]:checked')||{}).value||'NONE';$('you_prior_wrap').classList.toggle('hide',!(v==='YOU'||v==='BOTH'));$('spouse_prior_wrap').classList.toggle('hide',!(v==='SPOUSE'||v==='BOTH'));}
function b64ToBlob(b64, mime){const byteChars=atob(b64);const byteNums=new Array(byteChars.length);for(let i=0;i<byteChars.length;i++)byteNums[i]=byteChars.charCodeAt(i);const byteArray=new Uint8Array(byteNums);return new Blob([byteArray],{type:mime});}
async function applyToDocxBase(base64,map){
  if(!window.JSZip)throw new Error("JSZip not loaded");
  const zip=await JSZip.loadAsync(base64,{base64:true});
  const parts=['word/document.xml','word/header1.xml','word/header2.xml','word/header3.xml','word/footer1.xml','word/footer2.xml','word/footer3.xml'];
  for(const p of parts){
    const f=zip.file(p); if(!f)continue;
    let xml=await f.async('string');
    xml=normalizeXmlRuns(xml);
    map.forEach((v,k)=>{xml=xml.replace(k,v);});
    zip.file(p,xml);
  }
  const blob=await zip.generateAsync({type:'blob',mimeType:'application/vnd.openxmlformats-officedocument.wordprocessingml.document'});
  return new Blob([blob],{type:'application/vnd.openxmlformats-officedocument.wordprocessingml.document'});
}

async function buildAndDownloadDoc(fileKey,payload){
  const base64=(EMBEDDED_TEMPLATES[fileKey]||"").trim();
  if(!base64){toast(`Missing embedded template for ${fileKey}.`,false);return;}
  let blob,filename;
  try{
    if(fileKey==='RJI'||fileKey==='CERTDISS'){
      blob=b64ToBlob(base64,'application/pdf');
      filename=`NY_${fileKey}.pdf`;
    }else{
      const map=buildReplacementMap(payload);
      blob=await applyToDocxBase(base64,map);
      filename=`NY_${fileKey}.docx`;
    }
    saveAs(blob,filename);
    toast(`Downloading ${filename}`,true);
  }catch(err){
    console.error(err);
    toast(`Error processing ${fileKey}.`,false);
  }
}

async function downloadAllDocs(payload){
  const order=['COMPLAINT','AFF_P','AFF_D','REG','FIND','JUDG','NOI','CERT','RJI','CERTDISS','INSTR'];
  for(const key of order){
    if(!(EMBEDDED_TEMPLATES[key]||"").trim())continue;
    await buildAndDownloadDoc(key,payload);
    await new Promise(r=>setTimeout(r,350));
  }
}

document.addEventListener('DOMContentLoaded',()=>{
  // Populate choices
  (function setChoicesInit(){
    setChoices('county', NY_COUNTIES);
    setChoices('m_state', US_STATES);
  })();

  const usp=new URLSearchParams(location.search);
  if(usp.get('paid')==='1'||usp.has('session_id')){localStorage.setItem(FINAL_KEY,'1');}

  $('toStep2').addEventListener('click',()=>{
    if(!($('ack').checked&&$('phone').value.trim())){$('e1').style.display='block';toast("Please confirm requirements and add your phone.",false);return;}
    if(!vStep1()){$('e1').style.display='block';toast("üõë Please complete all required fields in Step 2.",false);return;}
    $('e1').style.display='none';
    document.querySelector('[data-step="1"]').classList.remove('active');
    document.querySelector('[data-step="2"]').classList.add('active');
    window.scrollTo({top:0,behavior:'smooth'});
  });

  $('gen').addEventListener('click',()=>{
    if(!vStep2()){$('e2').style.display='block';toast("üõë Please complete all required fields in Step 3.",false);return;}
    $('e2').style.display='none';
    $('downloads').classList.remove('hide');
    $('streak').style.background="linear-gradient(90deg,var(--primary-dark),var(--success))";
    $('downloads').scrollIntoView({behavior:'smooth'});
    if(localStorage.getItem(FINAL_KEY)==='1'){
      document.getElementById('gd').style.display='block';
      document.getElementById('headsup').style.display='none';
      document.getElementById('payCard').style.display='none';
    }else{
      document.getElementById('gd').style.display='none';
      document.getElementById('headsup').style.display='block';
    }
  });

  $('ctaUnlock').addEventListener('click',()=>{
    $('payCard').style.display='block';
    $('headsup').style.display='none';
    $('payCard').scrollIntoView({behavior:'smooth',block:'center'});
    toast("Scroll down to complete payment securely.",true);
  });

  function collectPayload(){return{
    spouse: $('you_are').value==='WIFE'?'Wife':'Husband',
    pl_name: $('pl_name').value,
    def_name: $('def_name').value,
    pl_addr: $('pl_addr').value,
    def_addr: $('def_addr').value,
    phone: $('phone').value,
    email: $('email').value,
    pl_dob: $('pl_dob').value,
    def_dob: $('def_dob').value,
    county: $('county').value,
    venue_reason: $('venue_reason').value,
    m_where: $('m_where').value,
    m_date: $('m_date').value,
    m_city: $('m_city').value,
    m_state: $('m_state').value,
    m_town: $('m_town').value,
    m_country: $('m_country').value,
    pl_ssn: $('pl_ssn').value,
    def_ssn: $('def_ssn').value,
    priorWho: (document.querySelector('[name="prior_who"]:checked')||{}).value||'NONE',
    pl_prior: $('pl_prior').value,
    sp_prior: $('sp_prior').value,
    resume_pl: $('resume_pl').checked,
    resume_sp: $('resume_sp').checked
  };}

  $('btnSAndC').addEventListener('click',async e=>{
    e.preventDefault();
    await buildAndDownloadDoc('COMPLAINT',collectPayload());
  });

  document.querySelectorAll('#gd button[data-doc], #downloads button[data-doc]').forEach(btn=>{
    btn.addEventListener('click',async e=>{
      e.preventDefault();
      const doc=e.currentTarget.getAttribute('data-doc');
      const payload=collectPayload();
      if(localStorage.getItem(FINAL_KEY)!=='1'&&doc!=='COMPLAINT'){
        toast("üõë Please complete payment to unlock this document.",false);
        $('payCard').style.display='block';
        $('headsup').style.display='none';
        $('payCard').scrollIntoView({behavior:'smooth',block:'center'});
        return;
      }
      await buildAndDownloadDoc(doc,payload);
    });
  });

  $('downloadAll').addEventListener('click',async ()=>{
    if(localStorage.getItem(FINAL_KEY)!=='1'){toast("Please complete payment to download all documents.",false);return;}
    await downloadAllDocs(collectPayload());
  });

  const usp2=new URLSearchParams(location.search);
  if(localStorage.getItem(FINAL_KEY)==='1'&&(usp2.get('paid')==='1'||usp2.has('session_id'))){
    setTimeout(async()=>{
      document.getElementById('gd').style.display='block';
      document.getElementById('headsup').style.display='none';
      toast("Payment confirmed ‚Äî unlocking and downloading your full package.",true);
      await downloadAllDocs(collectPayload());
      document.getElementById('gd')?.scrollIntoView({behavior:'smooth',block:'start'});
    },600);
  }

  onRoleChange(); 
  onCountyChange(); 
  onWhereChange(); 
  onPriorRadio();
});
</script>
</body>
</html>


