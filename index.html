<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NY Uncontested Divorce â€” Free Test Mode</title>
<meta name="description" content="Instant Summons & Complaint for NY uncontested divorce. Test mode: all downloads are free (no PayPal)."/>

<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#fff;color:#111}
  .wrap{max-width:980px;margin:22px auto;padding:0 16px}
  h1{margin:8px 0 10px}
  h3{margin:8px 0}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  .chip{border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;font-size:.92rem;background:#fff}
  .card{border:1px solid #e5e7eb;border-radius:12px;padding:16px 16px 18px;margin:14px 0;box-shadow:0 6px 16px rgba(0,0,0,.04)}
  label{display:block;margin:10px 0 6px;font-weight:600}
  input,select,textarea{width:100%;padding:12px;border:1px solid #e5e7eb;border-radius:8px;background:#f9fafb;box-sizing:border-box}
  .row{display:grid;gap:12px}
  @media(min-width:760px){.row-2{grid-template-columns:1fr 1fr}}
  .btn{display:inline-flex;gap:.5rem;align-items:center;justify-content:center;padding:12px 18px;border-radius:10px;border:0;background:#0d6efd;color:#fff;font-weight:700;cursor:pointer}
  .btn.alt{background:#16a34a}
  .note{font-size:.95rem;color:#374151}
  .hidden{display:none}
  .ok{color:#16a34a;font-weight:700}
  .guarantee{background:#f0fdf4;border:1px solid #bbf7d0;border-radius:10px;padding:10px;margin-top:8px}
  .error-text{color:#b91c1c;font-weight:600}
</style>
</head>
<body>
<div class="wrap">
  <h1>NY Uncontested Divorce (No Children)</h1>
  <div class="chips">
    <span class="chip">âœ… Court-Ready Formatting</span>
    <span class="chip">ðŸ”’ Secure PayPal (disabled for testing)</span>
    <span class="chip">ðŸ“¥ Instant Download</span>
    <span class="chip">ðŸ“§ Copy emailed to attorney</span>
  </div>

  <div class="card">
    <p class="note">
      Fill this out. Youâ€™ll get your <strong>Summons &amp; Complaint</strong> instantly for free. 
      Then choose either (a) <strong>$199</strong> for the full DIY pack (all remaining forms + instructions),
      or (b) <strong>$999</strong> attorney-handled service (we file for you &amp; cover filing fees).
    </p>
    <div class="guarantee">
      <strong>Weâ€™ve got your back:</strong> If any $199 package document is rejected for a formatting issue, weâ€™ll fix it free.
    </div>
  </div>

  <form id="qform" class="card">
    <h3>Your Info</h3>

    <label>Email (for receipts & document delivery) *</label>
    <input id="email" type="email" required placeholder="you@example.com"/>

    <div class="row row-2">
      <div>
        <label>Your Role *</label>
        <select id="you_are" required>
          <option value="">Selectâ€¦</option>
          <option value="HUSBAND">Husband (Plaintiff)</option>
          <option value="WIFE">Wife (Plaintiff)</option>
        </select>
      </div>
      <div>
        <label>Your Full Name *</label>
        <div class="row row-2">
          <input id="pl_first" required placeholder="First"/>
          <input id="pl_last" required placeholder="Last"/>
        </div>
      </div>
    </div>

    <label>Your Current Full Address *</label>
    <textarea id="pl_addr" required placeholder="Street, City, State ZIP"></textarea>

    <div class="row row-2">
      <div>
        <label>Your Date of Birth *</label>
        <input id="pl_dob" type="date" required/>
      </div>
      <div>
        <label>Phone *</label>
        <input id="phone" required placeholder="(___) ___-____"/>
      </div>
    </div>

    <h3>Spouse</h3>
    <div class="row row-2">
      <div>
        <label>Spouse Full Name *</label>
        <div class="row row-2">
          <input id="def_first" required placeholder="First"/>
          <input id="def_last" required placeholder="Last"/>
        </div>
      </div>
      <div>
        <label>Spouse DOB *</label>
        <input id="def_dob" type="date" required/>
      </div>
    </div>

    <label>Spouse Address *</label>
    <textarea id="def_addr" required placeholder="Street, City, State ZIP"></textarea>

    <h3>Venue &amp; Marriage</h3>
    <div class="row row-2">
      <div>
        <label>Filing County *</label>
        <select id="county" required></select>
      </div>
      <div>
        <label>Basis of Venue *</label>
        <select id="venue_reason" required>
          <option value="">Selectâ€¦</option>
          <option value="PLAINTIFF_LIVES">Plaintiff lives in filing county</option>
          <option value="DEFENDANT_LIVES">Defendant lives in filing county</option>
        </select>
      </div>
    </div>

    <div class="row row-2">
      <div>
        <label>Marriage Country *</label>
        <select id="m_country_sel" required>
          <option value="">Selectâ€¦</option>
          <option value="USA">USA</option>
          <option value="INTL">Outside of the United States</option>
        </select>
      </div>
      <div>
        <label>Marriage Date *</label>
        <input id="m_date" type="date" required/>
      </div>
    </div>

    <div class="row row-2">
      <div>
        <label id="m_city_label">Marriage City *</label>
        <input id="m_city" required/>
      </div>
      <div>
        <label id="m_state_label">Marriage State *</label>
        <input id="m_state_or_country" required placeholder="NY (or country if outside USA)"/>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Wifeâ€™s Maiden Name *</label>
        <input id="wife_maiden" placeholder="If unchanged, re-enter current last name"/>
      </div>
    </div>

    <div style="margin-top:12px">
      <button class="btn" id="build">Generate Free Summons &amp; Complaint</button>
      <span id="status" class="note"></span>
    </div>
  </form>

  <div id="freeBlock" class="card hidden">
    <h3 class="ok">Your Summons &amp; Complaint is ready âœ…</h3>
    <p class="note">
      This document is based on your answers and ready to file for a New York uncontested divorce with no children.
    </p>
    <button class="btn alt" id="downloadSAndC">Download Summons &amp; Complaint (.docx)</button>
  </div>

  <div id="fullPackage" class="card hidden">
    <h3>Full Package (Test Mode: Free)</h3>
    <p class="note">
      All downloads are enabled for testing. In production, these unlock after payment.
    </p>
    <div style="display:grid;gap:10px">
      <button class="btn" data-doc="AFF_P">Affirmation of Plaintiff</button>
      <button class="btn" data-doc="AFF_D">Affirmation of Defendant</button>
      <button class="btn" data-doc="REG">Affirmation of Regularity</button>
      <button class="btn" data-doc="FIND">Findings &amp; Conclusions</button>
      <button class="btn" data-doc="JUDG">Proposed Judgment</button>
      <button class="btn" data-doc="NOI">Note of Issue</button>
      <button class="btn" data-doc="CERT">Certification</button>
      <button class="btn" data-doc="RJI">RJI (PDF)</button>
      <button class="btn" data-doc="CERTDISS">Certificate of Dissolution (PDF)</button>
      <button class="btn" data-doc="INSTR">Step-by-Step Instructions</button>
    </div>
  </div>

  <div class="card note">
    Disclaimer: We prepare documents from your answers; you are responsible for signing and filing unless you choose the attorney-handled option.
  </div>
</div>

<script>
/* === CONFIG === */
const FREE_MODE = true; // all docs unlocked (no PayPal while testing)

// Your already-deployed Apps Script Web App URL:
const APPS_SCRIPT_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxYcXRcA2G5QmacxUA1AsihyNxB386ZLIQlL7xC8BIN0728hNQ1WRtB3ihFhqwIWJSA/exec";

const BOROUGH_FIRST = ["Bronx","Kings","New York","Queens","Richmond"];
const OTHER_COUNTIES = ["Albany","Allegany","Broome","Cattaraugus","Cayuga","Chautauqua","Chemung","Chenango","Clinton","Columbia","Cortland","Delaware","Dutchess","Erie","Essex","Franklin","Fulton","Genesee","Greene","Hamilton","Herkimer","Jefferson","Lewis","Livingston","Madison","Monroe","Montgomery","Nassau","Niagara","Oneida","Onondaga","Ontario","Orange","Orleans","Oswego","Otsego","Putnam","Rensselaer","Rockland","St. Lawrence","Saratoga","Schenectady","Schoharie","Schuyler","Seneca","Steuben","Suffolk","Sullivan","Tioga","Tompkins","Ulster","Warren","Washington","Wayne","Westchester","Wyoming","Yates"];
const NY_COUNTIES = [...BOROUGH_FIRST, ...OTHER_COUNTIES];

const $ = s => document.querySelector(s);

function setChoices(el, arr){
  el.innerHTML = '<option value="">Selectâ€¦</option>' + arr.map(x=>`<option>${x}</option>`).join('');
}

function collectPayload(){
  const isUSA = $('#m_country_sel').value === 'USA';
  return {
    role: $('#you_are').value,
    pl_first: $('#pl_first').value.trim(),
    pl_last:  $('#pl_last').value.trim(),
    pl_addr: $('#pl_addr').value.trim(),
    pl_dob: $('#pl_dob').value,
    phone: $('#phone').value.trim(),
    email: $('#email').value.trim(),
    def_first: $('#def_first').value.trim(),
    def_last:  $('#def_last').value.trim(),
    def_dob: $('#def_dob').value,
    def_addr: $('#def_addr').value.trim(),
    county: $('#county').value,
    venue_reason: $('#venue_reason').value,
    m_date: $('#m_date').value,
    m_country_sel: $('#m_country_sel').value,
    m_city: $('#m_city').value.trim(),
    m_state_or_country: $('#m_state_or_country').value.trim(),
    wife_maiden: $('#wife_maiden').value.trim(),
    marriage_is_usa: isUSA
  };
}

/* Convert base64 string to downloadable file */
function downloadBase64File(b64, fileName, mime){
  const byteChars = atob(b64);
  const byteNumbers = new Array(byteChars.length);
  for (let i = 0; i < byteChars.length; i++) {
    byteNumbers[i] = byteChars.charCodeAt(i);
  }
  const byteArray = new Uint8Array(byteNumbers);
  const blob = new Blob([byteArray], {type: mime});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = fileName;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

/* Call Apps Script to build a DOCX from a Drive template */
async function buildDocFromServer(docKey, payload, paidTier){
  const res = await fetch(APPS_SCRIPT_WEBAPP_URL, {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({
      action: "buildDoc",
      docKey,
      payload,
      paidTier: paidTier || "FREE_TEST"
    })
  });
  if (!res.ok) throw new Error("Network error");
  const data = await res.json();
  if (!data.ok) throw new Error(data.error || "Server error");
  return data; // { ok:true, docB64, fileName, mimeType }
}

document.addEventListener('DOMContentLoaded', () => {
  // 1) Set counties
  setChoices($('#county'), NY_COUNTIES);

  // 2) Dynamic marriage labels
  function updateMarriageLabels(){
    const isUSA = $('#m_country_sel').value === 'USA';
    $('#m_city_label').textContent = isUSA ? 'Marriage City *' : 'Marriage Town *';
    $('#m_state_label').textContent = isUSA ? 'Marriage State *' : 'Marriage Country *';
    $('#m_state_or_country').placeholder = isUSA ? 'NY' : 'Country (e.g., Jamaica)';
  }
  $('#m_country_sel').addEventListener('change', updateMarriageLabels);
  updateMarriageLabels();

  let lastComplaintDoc = null; // {b64,fileName,mime}

  // 3) Generate free S&C by asking Apps Script
  $('#build').addEventListener('click', async (e)=>{
    e.preventDefault();
    const statusEl = $('#status');
    statusEl.classList.remove('error-text');
    statusEl.textContent = "Building your Summons & Complaintâ€¦";

    try{
      const payload = collectPayload();
      const result = await buildDocFromServer("COMPLAINT", payload, "FREE_TEST");
      lastComplaintDoc = {
        b64: result.docB64,
        fileName: result.fileName || "NY_Summons_and_Complaint.docx",
        mime: result.mimeType || "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
      };

      statusEl.textContent = "Ready! Scroll down to download.";
      $('#freeBlock').classList.remove('hidden');
      if (FREE_MODE) $('#fullPackage').classList.remove('hidden');
    }catch(err){
      console.error(err);
      statusEl.classList.add('error-text');
      statusEl.textContent = "There was a technical issue building the document. Please try again.";
    }
  });

  // 4) Download S&C
  $('#downloadSAndC').addEventListener('click', ()=>{
    if (!lastComplaintDoc) return;
    downloadBase64File(lastComplaintDoc.b64, lastComplaintDoc.fileName, lastComplaintDoc.mime);
  });

  // 5) Full package buttons â†’ ask Apps Script for the corresponding template
  document.querySelectorAll('#fullPackage [data-doc]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const key = btn.getAttribute('data-doc');
      const statusEl = $('#status');
      statusEl.classList.remove('error-text');
      statusEl.textContent = "Preparing " + key + "â€¦";

      try{
        const payload = collectPayload(); // sa
